# イベントタグ機能仕様書

## 1. 目的

サーバー内で行われる多種多様なイベントを、内容に応じて「タグ」で分類・整理する。
タグシステム方式（B案）を採用し、AIのサジェストと人の編集を組み合わせて精度を高める。
これにより、以下の実現を目指す。

- **主催者の支援**: イベント主催者が「希望ジャンル」「希望ゲーム」「空きスケジュール」を登録し、システムが最適なイベント開催を提案できるようにする。
- **参加者のマッチング**: 参加者が興味のあるタグを登録・閲覧することで、自分の好みに合ったイベントを見つけやすくする。
- **潜在的な主催者の発掘**: 特定のタグに興味を持つ参加者に対し、関連イベントの主催を促す（サジェストする）ことで、新たな主催者を増やす。

## 2. 機能要件

### やりたいこと（全体像・将来的な展望）

- イベントのタイトルや説明文を基に、AI（Gemini）が自動で適切なタグをサジェストする。
- イベント登録者は、AIがサジェストしたタグを確認し、不要なものを削除したり、不足しているものを自由に追加したりできる。
- AIは、イベント登録者が最終的に確定させたタグの組み合わせを学習データとし、タグのサジェスト精度を継続的に向上させる。
- ユーザーは「興味のあるタグ」をプロフィール等に登録できる（将来的な実装）。
- 興味タグに基づき、ユーザーにおすすめのイベントを通知・表示する（将来的な実装）。
- 興味タグに合致するイベントで、まだ主催者が決まっていないものや、主催者を募集しているものをユーザーに提示し、「主催してみませんか？」とサジェストする（将来的な実装）。
- タグに基づいたイベントの検索機能・フィルタリング機能。
- タグの種類は自由文字列を基本とし、初期実装ではメタ情報を持たないシンプルな構造とする。
- イベントタグの決定履歴や人気推移の可視化は将来的な拡張とする。

### 今やること（フェーズ1）

- **DB設計（今回実装）**:
    - タグ情報を格納する `Tag` テーブルを作成（`id`, `name`, `createdAt` のみ）。
    - イベントとタグの中間テーブル `EventToTag` を作成する。
    - ユーザーと興味タグの中間テーブル（タグIDとユーザーID）は将来的なTODOとして設計に余白を残す。
- **タグ付け機能の実装**:
    - `/event_creator setup` でAIが各イベントにタグ候補をサジェストし、各イベントに「タグを編集」ボタンと「全てタグを確定」ボタンを設置する。
    - 「タグを編集」からダイアログを開き、テキストラベルでAI候補と現在のタグを提示し、テキストフィールドには現在のタグをスペース区切りでプリセットする（入力・編集もスペース区切り方式）。
    - コマンド実行時、イベントのタイトルや説明文を `Gemini AI` のAPIに送信し、タグ候補（既存タグにないものも含む）をJSONで受け取る。
    - AI候補は「既存タグから選んだもの1～3個（デフォルト選択）＋既存にないもの1～2個（デフォルト未選択）」を提示し、確定ボタンを押すまで確定しない。
    - AI候補から「新しいタグを付けるべきでは？」という発想を促す文脈で提示し、不要な候補は外し、新規タグも追加できるようにする。
    - 基本的に同一イベントでは過去と同じタグが再利用されるよう、イベントIDをキーに既存タグを初期表示する。
    - 各イベントのタグ編集を完了したら「全てタグを確定」を押して一括確定し、その内容をDBに保存する。
## 3. 技術選定

- **AIモデル**: Gemini AI (無料版) を採用し、API経由でタグのサジェスト機能を実現する。

## 4. 設計メモ

- **Tagモデル**: `id`, `name`, `createdAt` のシンプル構成とし、自由入力タグを軽量に扱う。
- **イベント登録フロー**: `/event_creator setup` でAI候補を一覧サジェスト → 各イベントの「タグ編集」からダイアログで調整（スペース区切り入力、現在タグをプリセット） → 全イベントの調整完了後に「全てタグを確定」で一括保存（同イベントでは既存タグを初期値）。
- **興味タグフロー**: 将来的にユーザーがタグを追加・削除し、おすすめ提示に利用する（今回未実装）。
- **学習データ**: 確定タグと候補提示状況を保持し、将来的なサジェスト精度改善に利用する。

## 5. 今後の展望

- **興味タグの登録・活用（将来的なTODO）**:
    - ユーザープロフィールに興味タグを保存する。
    - 興味タグをキーに、開催・募集前のイベントをおすすめ表示する。
    - 興味タグとイベントタグのマッチ率を記録し、サジェスト精度の改善に利用する。
- **イベント表示への反映**:
    - イベント告知メッセージなどの表示に、設定されたタグを一覧表示する。
    - イベントの説明欄に「≪主催者≫ #タグ1 #タグ2 #タグ3」のように、ハッシュタグ形式で表示する。
